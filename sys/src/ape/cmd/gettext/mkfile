</$objtype/mkfile
APEXPROOT=../../../../..
TARG=	msgfmt\
		msgmerge

PARSEROBJS =	poparser.$O\
				StringEscape.$O

LIB=$APEXPROOT/$objtype/lib/ape/libintl.a
BIN=$APEXPROOT/$objtype/bin/ape
HFILES=$APEXPROOT/sys/include/ape/libintl.h

<$APEXPROOT/sys/src/cmd/mkmany

GETTEXTSRC=../../../external/gettext-tiny

CC=pcc
LD=pcc
CFLAGS=-c -I$GETTEXTSRC/src -D_POSIX_SOURCE -D_SUSV2_SOURCE -D_BSD_EXTENSION -D_LIMITS_EXTENSION

%.$O: $GETTEXTSRC/src/%.c
	$CC $CFLAGS $GETTEXTSRC/src/$stem.c

$O.msgfmt:V: msgfmt.$O $PARSEROBJS
	$LD -o $target $prereq

$O.msgmerge:V: msgfmt.$O $PARSEROBJS
	$LD -o $target $prereq

install:V:
	mk all
	cp $O.msgfmt $BIN/msgfmt
	cp $O.msgmerge $BIN/msgmerge
	cp $GETTEXTSRC/src/xgettext.sh $APEXPROOT/rc/bin/ape/xgettext
	cat $GETTEXTSRC/src/autopoint.in | sed 's,@datadir@,/sys/lib/ape,' > $APEXPROOT/rc/bin/ape/autopoint
	chmod +x $APEXPROOT/rc/bin/ape/*
	mkdir -p $APEXPROOT/sys/lib/ape/m4
	dircp $GETTEXTSRC/m4 $APEXPROOT/sys/lib/ape/m4
	mkdir -p $APEXPROOT/sys/lib/ape/data
	dircp $GETTEXTSRC/data $APEXPROOT/sys/lib/ape/data

