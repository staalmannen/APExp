</$objtype/mkfile
APEXPROOT=../../../../..
TARG=	\
#gettext-runtime/src \
      	gettext\
      	ngettext\
      	envsubst\
#gettext-tools/src \
      	msgattrib\
		msgcat\
		msgcmp\
		msgcomm\
		msgconv\
		msgen\
		msgexec\
#		msgfilter\
#		msgfmt\
#		msggrep\
#		msginit\
#		msgmerge\
#		msgunfmt\
		msguniq\
#      	xgettext\
#      	recode-sr-latin
#gettext-tools/misc \
#      	gettextize\
#      	autopoint


GNULIB_OBJECTS=	\
#gnulib-lib\
		basename-lgpl.$O\
		canonicalize-lgpl.$O\
		c-strcasecmp.$O\
		c-strncasecmp.$O\
		c32iscntrl.$O\
		c32width.$O\
		c32isalnum.$O\
		c32isspace.$O\
		clean-temp.$O\
		closeout.$O\
		concat-filename.$O\
#		copy-file.$O\
		dup-safer-flag.$O\
		error.$O\
		error-progname.$O\
		exitfail.$O\
		fd-safer-flag.$O\
		findprog.$O\
		findprog-in.$O\
		full-write.$O\
		fwriteerror.$O\
		getprogname.$O\
		malloca.$O\
		mbchar.$O\
		mbtowc-lock.$O\
		mbrtoc32.$O\
		mbslen.$O\
		mbsinit.$O\
		mbsstr.$O\
		mempcpy.$O\
		mbuiter.$O\
		mkdtemp.$O\
		pipe2.$O\
		pipe2-safer.$O\
		progname.$O\
		propername.$O\
		progreloc.$O\
		reallocarray.$O\
		setenv.$O\
		spawn-pipe.$O\
		spawn_faction_addchdir.$O\
		spawn_faction_addclose.$O\
		spawn_faction_adddup2.$O\
		spawn_faction_addopen.$O\
		spawn_faction_destroy.$O\
		spawn_faction_init.$O\
		strnlen1.$O\
		striconv.$O\
		trim.$O\
		unsetenv.$O\
		wait-process.$O\
		xalloc-die.$O\
		xconcat-filename.$O\
		xmalloc.$O\
		xsetenv.$O\
		xstriconv.$O\
# libgrep \
		m-regex.$O\
		m-fgrep.$O

LIB=\
	libgnu.a$O\
	$APEXPROOT/$objtype/lib/ape/libtextstyle.a\
	$APEXPROOT/$objtype/lib/ape/libgettextpo.a\
	$APEXPROOT/$objtype/lib/ape/libintl.a\
	$APEXPROOT/$objtype/lib/ape/libiconv.a\
	$APEXPROOT/$objtype/lib/ape/libcurses.a\
	$APEXPROOT/$objtype/lib/ape/libxml.a


BIN=$APEXPROOT/$objtype/bin/ape

HFILES=$APEXPROOT/sys/include/ape/libintl.h

<$APEXPROOT/sys/src/cmd/mkmany

GETTEXTSRC=../../../external/gettext

CC=pcc
LD=pcc
DEFS= 	-DLOCALEDIR="/sys/lib/ape/locale" -DBISON_LOCALEDIR="/sys/lib/ape/locale" -DLIBDIR="/$objtype/lib/ape"\
		-DEXEEXT="" -DPROJECTSDIR="." -DGETTEXTJAR="/sys/lib/ape/gettext" -DGETTEXTDATADIR="/sys/lib/ape/gettext"\
		-Drpl_optarg=optarg -Drpl_getopt=getopt -Drpl_optind=optind -Drpl_getopt_long=getopt_long -Drpl_malloc=malloc\
		-Drpl_realloc=realloc -Drpl_calloc=calloc -Drpl_free=free -Drpl_rmdir=rmdir -Drpl_open=open -Drpl_strtol=strtol\
		-Drpl_readlink=readlink -Drpl_fcntl=fcntl -Drpl_posix_spawnattr_init=posix_spawnattr_init\
		-DENABLE_NLS -DHAVE_ICONV -DGNULIB_MBRTOC32_REGULAR -DGNULIB_MBRTOWC_SINGLE_THREAD -DPLAN9

RINCLUDE= 	-I$GETTEXTSRC/gettext-runtime/src -I$GETTEXTSRC/gettext-runtime\
			-I$GETTEXTSRC/gettext-runtime/gnulib-lib -I$GETTEXTSRC/gettext-runtime/intl

TINCLUDE= 	-I$GETTEXTSRC/gettext-tools -I$GETTEXTSRC/gettext-tools/src -I$GETTEXTSRC/gettext-tools/gnulib-lib\
		  	-I$GETTEXTSRC/libtextstyle/lib -I$GETTEXTSRC/gnulib-local/lib\
			-I$GETTEXTSRC/gettext-tools/libgrep $GETTEXTSRC/gettext-tools/libgettextpo $RINCLUDE

CFLAGS=-c -B -DHAVE_CONFIG_H -D_POSIX_SOURCE -D_BSD_EXTENSION $DEFS

hash-string.$O: $GETTEXTSRC/gettext-runtime/intl/hash-string.c
	$CC $CFLAGS $RINCLUDE $GETTEXTSRC/gettext-runtime/intl/hash-string.c

%.$O: $GETTEXTSRC/gettext-runtime/src/%.c
	$CC $CFLAGS $RINCLUDE $GETTEXTSRC/gettext-runtime/src/$stem.c

%.$O: $GETTEXTSRC/gettext-tools/src/%.c
	$CC $CFLAGS $TINCLUDE $GETTEXTSRC/gettext-tools/src/$stem.c

%.$O: $GETTEXTSRC/gettext-tools/gnulib-lib/%.c
	$CC $CFLAGS $TINCLUDE $GETTEXTSRC/gettext-tools/gnulib-lib/$stem.c

%.$O: $GETTEXTSRC/gettext-tools/libgrep/%.c
	$CC $CFLAGS $TINCLUDE $GETTEXTSRC/gettext-tools/libgrep/$stem.c


libgnu.a$O:V:	$GNULIB_OBJECTS
				ar vu libgnu.a$O $GNULIB_OBJECTS

#write-java.$O write-csharp.$O
$O.msgfmt:V: 	msgfmt.$O write-mo.$O write-resources.$O\
				write-tcl.$O write-qt.$O write-desktop.$O write-xml.$O hash-string.$O $LIB
				$LD -o $target $prereq

$O.msgcmp:V: 	msgcmp.$O msgl-fsearch.$O $LIB
				$LD -o $target $prereq

$O.msgunfmt:V:	msgunfmt.$O read-mo.$O read-java.$O read-csharp.$O read-resources.$O\
				read-tcl.$O hash-string.$O $LIB
				$LD -o $target $prereq




