APE=/sys/src/ape
<$APE/config

LIB=libutil.a$O libutf.a$O
TARG= \
# APE\
		basename\
		dirname\
		kill\
		printf\
		uname\
# sbase\
		cut\
		false\
#		find\
		grep\
		ls\
		true\
		tsort\
#		which\
		xargs\
		yes

BIN=/$objtype/bin/ape
</sys/src/cmd/mkmany

SBASESRC=../../../external/sbase

CC=pcc
LD=pcc

CFLAGS=-c -D_POSIX_SOURCE

CPPFLAGS =\
	-D_DEFAULT_SOURCE \
	-D_NETBSD_SOURCE \
	-D_BSD_SOURCE \
	-D_XOPEN_SOURCE=700 \
	-D_FILE_OFFSET_BITS=64

SBASE_CFLAGS=-c $CPPFLAGS -I$SBASESRC -I$SBASESRC/libutil -I$SBASESRC/../gnulib -D_POSIX_SOURCE -D_BSD_EXTENSION \
		-D_LIMITS_EXTENSION -D_RESEARCH_SOURCE -DS_ISVTX=S_IROTH -DS_ISSOCK=S_ISFIFO 

%.$O: $SBASESRC/%.c
	$CC $SBASE_CFLAGS $SBASESRC/$stem.c

%.$O: %.c
	$CC $CFLAGS $stem.c

install:V:
	mk -f mkfile.bin all
	for (i in $TARG)
		@{ cp $O.$i $BIN/$i }
	cp $SBASESRC/cut.1 /sys/man/1/cut
	cp $SBASESRC/false.1 /sys/man/1/false
	cp $SBASESRC/find.1 /sys/man/1/find
	cp $SBASESRC/true.1 /sys/man/1/true
	cp $SBASESRC/tsort.1 /sys/man/1/tsort
	cp $SBASESRC/which.1 /sys/man/1/which
	cp $SBASESRC/xargs.1 /sys/man/1/xargs
	cp $SBASESRC/yes.1 /sys/man/1/yes
	mkdir -p /sys/man/1ape
	cp $SBASESRC/ls.1 /sys/man/1ape/ls
	rm -f /rc/bin/ape/ls
	cp $SBASESRC/grep.1 /sys/man/1ape/grep
	rm -f /rc/bin/ape/grep
	cp egrep.rc /rc/bin/ape/egrep
	cp fgrep.rc /rc/bin/ape/fgrep
	cp psh.rc /rc/bin/ape/psh
	chmod +x /rc/bin/ape/*
